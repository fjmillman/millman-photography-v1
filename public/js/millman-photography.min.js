(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";$(document).ready(function(){var a=["ashness-jetty","swaledale","northumberland"];setInterval(function(){var b=a[Math.floor(Math.random()*a.length)];$("#background-image").css("background-image","url(http://millmanphotography.dev/img/"+b+".jpg)")},1e4)})},{}],2:[function(require,module,exports){"use strict";$(document).ready(function(){function a(a){d.trigger("reset");var b=$("<p>").text(a).css("color","green").prependTo(e.parent());setTimeout(function(){b.remove()},2500)}function b(a){var b=$("<p>").text(a.responseJSON).css("color","red").prependTo(e.parent());setTimeout(function(){b.remove()},2500)}function c(a){var b=a.getResponseHeader("X-CSRFToken");if(b){b=$.parseJSON(b);var c=Object.keys(b),e=d.find('input.csrf[type="hidden"]');c.length===e.length&&e.each(function(a){$(this).attr("name",c[a]),$(this).val(b[c[a]])})}}var d=$("#enquiry-form"),e=$("#submit");d.on("submit",function(){return $.ajax({url:d.attr("action"),method:d.attr("method"),data:d.serialize(),cache:!1,dataType:"json"}).done(a).fail(b).always(c),!1})})},{}],3:[function(require,module,exports){"use strict";require("./background"),require("./form"),require("./scroll"),require("./tags")},{"./background":1,"./form":2,"./scroll":4,"./tags":5}],4:[function(require,module,exports){"use strict";$(document).ready(function(){$(document).on("click","a[href*=\\#]:not([href=\\#])",function(a){a.preventDefault();var b=$(this).attr("href"),c=$(b).offset().top+2;$("html, body").animate({scrollTop:c},600)})})},{}],5:[function(require,module,exports){"use strict";var _tokenfield=require("./tokenfield"),_tokenfield2=_interopRequireDefault(_tokenfield);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var tagDataElement=document.getElementById("tags");if(null!==tagDataElement){var tagData=JSON.parse(tagDataElement.dataset.tagData);new _tokenfield2.default({el:document.getElementById("tags"),items:tagData.tags,setItems:tagData.selected_tags,itemName:"tags",newItemName:"new_tags",addItemOnBlur:!0,addItemsOnPaste:!0,delimiters:[","," "],minChars:0})}},{"./tokenfield":6}],6:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_events=require("events"),_events2=_interopRequireDefault(_events);Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _tokenfields={},reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),_factory=document.createElement("div"),_templates={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <input class="tokenfield-copy-helper"\n        style="position:fixed;left:-1000000px"\n        tabindex="-1"\n        type="text"\n      />\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <a href="#" class="item-remove" tabindex="-1">Ã—</a>\n      <input class="item-input" type="hidden" />\n    </li>'};function guid(){return(0|65536*(1+Math.random())).toString(16)+(0|65536*(1+Math.random())).toString(16)}function getPath(a){for(var b=[a];a.parentNode;)a=a.parentNode,b.push(a);return nodes}function build(a,b){return a.nodeName?a:(a=a.replace(/(\t|\n$)/g,""),_factory.innerHTML="",_factory.innerHTML=a,!0===b?_factory.childNodes:_factory.childNodes[0])}function toString(a){if("string"==typeof a)return a;if(null===a)return"";var b=a+"";return"0"==b&&1/a==-Infinity?"-0":b}function keyToChar(a){return a.key||String.fromCharCode(parseInt(a.keyIdentifier.substr(2),16))}function escapeRegex(a){return a=toString(a),a&&reHasRegExpChar.test(a)?a.replace(reRegExpChar,"\\$&"):a}function ajax(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=new XMLHttpRequest,e=b.url,f=[];for(var h in a)f.push(h+"="+a[h]);var g=f.join("&");return"get"===b.type.toLowerCase()&&(e+="?"+g),d.open(b.type,e,!0),c&&(d.onreadystatechange=c),d.send(a),d}function makeDefaultsAndOptions(){return{_defaults:{focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{},delimiters:{}},_options:{el:null,form:!0,mode:"tokenfield",addItemOnBlur:!1,addItemsOnPaste:!1,setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,keys:{8:"delete",9:"delimiter",13:"delimiter",16:"shift",17:"ctrl",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"select",67:"copy",91:"meta",108:"delimiter"},delimiters:[],copyProperty:"name",copyDelimiter:", ",remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{}},placeholder:null,inputType:"text",minChars:2,maxSuggest:10,filterSetItems:!0,itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name"}}}var Tokenfield=function(a){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),d=makeDefaultsAndOptions(),e=d._defaults,f=d._options;c.id=guid(),c.key="key_"+c.id,c._vars=Object.assign({},e),c._options=Object.assign({},f,a),c._options.keys=Object.assign({},f.keys,a.keys),c._options.remote=Object.assign({},f.remote,a.remote),c._templates=Object.assign({},_templates,a.templates),c._vars.setItems=c._prepareData(c._options.setItems||[]),c._focused=!1,c._form=!1,c._html={};var g=c._options;if(g.delimiters.forEach(function(a){c._vars.delimiters[a]=!0}),g.el.nodeName)c.el=g.el;else if("string"==typeof g.el){var h=document.querySelector(g.el);if(!h)throw new Error("Selector: DOM Element "+g.el+" not found.");c.el=h}else throw new Error("Cannot create tokenfield without DOM Element.");if(c.el.tokenfield=c,null===g.placeholder&&(g.placeholder=g.el.placeholder||""),g.form){var i=!1;if(g.form.nodeName)i=g.form;else if(!0===g.form)for(var j=c.el;j.parentNode;){if("FORM"===j.nodeName){i=j;break}j=j.parentNode}else if("string"==typeof i&&(i=document.querySelector(i),!i))throw new Error("Selector: DOM Element "+g.form+" not found.");c._form=i}else throw new Error("Cannot create tokenfield without DOM Element.");return _tokenfields[c.id]=c,c._render(),c}return _inherits(b,a),_createClass(b,[{key:"_render",value:function _render(){var a=this._options,b=this._html;return b.container="tokenfield"===a.mode?build(this._templates.containerTokenfield):build(this._templates.containerList),b.suggest=b.container.querySelector(".tokenfield-suggest"),b.suggestList=b.container.querySelector(".tokenfield-suggest-list"),b.items=b.container.querySelector(".tokenfield-set > ul"),b.input=b.container.querySelector(".tokenfield-input"),b.input.setAttribute("type",a.inputType),b.input.placeholder=a.placeholder,b.copyHelper=b.container.querySelector(".tokenfield-copy-helper"),a.el.style.display="none",b.suggest.style.display="none",this._renderSizer(),b.container.tokenfield=this,a.el.parentElement.insertBefore(b.container,a.el),b.container.insertBefore(a.el,b.container.firstChild),this._setEvents(),this._renderItems(),"tokenfield"===a.mode&&this._resizeInput(),this}},{key:"_renderSizer",value:function _renderSizer(){var a=this._html,c=this._getBounds(),b=window.getComputedStyle(a.container),d=parseInt(b.paddingLeft,10)+parseInt(b.paddingRight,10),e={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:c.width-d+"px",position:"fixed",top:"-10000px",left:"10000px",fontSize:b.fontSize,paddingLeft:b.paddingLeft,paddingRight:b.paddingRight};for(var f in a.sizer=document.createElement("div"),a.sizer.id="tokenfield-sizer-"+this.id,e)a.sizer.style[f]=e[f];a.container.appendChild(a.sizer)}},{key:"_refreshInput",value:function _refreshInput(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0,b=this._vars,c=this._html;if(a&&(c.input.value=""),"tokenfield"===this._options.mode){this._resizeInput();var d=b.setItems.length?"":this._options.placeholder;c.input.setAttribute("placeholder",d)}return this}},{key:"_resizeInput",value:function _resizeInput(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",c=this._html,d=this._getBounds(),b=window.getComputedStyle(c.container),e=parseInt(b.paddingRight,10)+parseInt(b.borderRightWidth,10),f=e+parseInt(b.paddingLeft,10)+parseInt(b.borderLeftWidth,10);c.sizer.innerHTML=a,c.input.style.width="20px";var g=c.sizer.getBoundingClientRect(),h=c.input.getBoundingClientRect(),i=d.width-(h.left-d.left)-e;c.input.style.width=g.width>i?d.width-f+"px":i+"px"}},{key:"_fetchData",value:function _fetchData(a){var b=this,c=this._vars,d=this._options,e=d.remote,f=Object.assign({},d.params);for(var g in e.params)f[g]=e.params[g];e.limit&&(f[e.limit]=d.remote.limit),f[e.queryParam]=a,f[e.timestampParam]=Math.round((new Date).getTime()/1e3),c.xhr=ajax(f,d.remote,function(){if(4==c.xhr.readyState){if(200==c.xhr.status){var e=JSON.parse(c.xhr.responseText);c.cache[a]=e;var f=b._prepareData(b.remapData(e)),g=b._filterData(a,f);c.suggestedItems=d.filterSetItems?b._filterSetItems(g):g,b.showSuggestions()}else if(0<c.xhr.status)throw new Error("Error while loading remote data.");b._abortXhr()}})}},{key:"remapData",value:function remapData(a){return a}},{key:"_prepareData",value:function _prepareData(a){var b=this;return a.map(function(a){return Object.assign({},a,_defineProperty({},b.key,guid()))})}},{key:"_filterData",value:function _filterData(a,b){var c=this._options,d=new RegExp(escapeRegex(a),"i");return b.filter(function(a){return d.test(a[c.itemData])})}},{key:"_abortXhr",value:function _abortXhr(){var a=this._vars;null!==a.xhr&&(a.xhr.abort(),a.xhr=null)}},{key:"_filterSetItems",value:function _filterSetItems(a){var b=this._options.itemValue,c=this._vars;if(!c.setItems.length)return a;var d=c.setItems.map(function(a){return a[b]});return a.filter(function(a){return-1===d.indexOf(a[b])})}},{key:"_setEvents",value:function _setEvents(){var a=this._vars,b=this._html;a.events.onClick=this._onClick.bind(this),a.events.onMouseDown=this._onMouseDown.bind(this),a.events.onMouseOver=this._onMouseOver.bind(this),a.events.onFocus=this._onFocus.bind(this),a.events.onResize=this._onResize.bind(this),a.events.onReset=this._onReset.bind(this),a.events.onKeyDown=this._onKeyDown.bind(this),a.events.onFocusOut=this._onFocusOut.bind(this),b.container.addEventListener("click",a.events.onClick),1===Object.keys(_tokenfields).length&&(document.addEventListener("mousedown",a.events.onMouseDown),document.addEventListener("touchstart",a.events.onMouseDown),window.addEventListener("resize",a.events.onResize)),this._form&&this._form.nodeName&&this._form.addEventListener("reset",a.events.onReset),b.suggestList.addEventListener("mouseover",a.events.onMouseOver),b.input.addEventListener("focus",a.events.onFocus)}},{key:"_onMouseOver",value:function _onMouseOver(a){var b=a.target;if(b.classList.contains("tokenfield-suggest-item")){var c=[].concat(_toConsumableArray(this._html.suggestList.querySelectorAll(".selected")));c.forEach(function(a){a!==b&&a.classList.remove("selected")}),b.classList.add("selected"),this._selectItem(b.key),this._refreshItemsSelection()}}},{key:"_onReset",value:function _onReset(){this.setItems(this._options.setItems)}},{key:"_onFocus",value:function _onFocus(){var a=this._vars,b=this._html,c=this._options;b.input.removeEventListener("keydown",a.events.onKeyDown),b.input.addEventListener("keydown",a.events.onKeyDown),b.input.addEventListener("focusout",a.events.onFocusOut),c.addItemsOnPaste&&(a.events.onPaste=this._onPaste.bind(this),b.input.addEventListener("paste",a.events.onPaste)),this.focus(),this._focused=!0,b.input.value.trim().length>=c.minChars&&this.showSuggestions()}},{key:"_onFocusOut",value:function _onFocusOut(a){var b=this._vars,c=this._options,d=this._html;if(d.input.removeEventListener("keydown",b.events.onKeyDown),d.input.removeEventListener("focusout",b.events.onFocusOut),"undefined"!=typeof b.events.onPaste&&d.input.removeEventListener("paste",b.events.onPaste),!(a.relatedTarget&&a.relatedTarget===d.copyHelper)){var e=!c.maxItems||c.maxItems&&b.setItems.length<c.maxItems;this._focused&&c.addItemOnBlur&&e&&this._newItem(d.input.value)?this._renderItems()._refreshInput().focus():this._defocusItems()._renderItems(),this._focused=!1}}},{key:"_onMouseDown",value:function _onMouseDown(a){var b=null;for(var c in _tokenfields)if(_tokenfields[c]._html.container.contains(a.target)){b=_tokenfields[c];break}if(b){for(var d in _tokenfields)d!==b.id&&(_tokenfields[d].hideSuggestions(),_tokenfields[d].blur());a.target!==b._html.input&&a.preventDefault()}else for(var e in _tokenfields)_tokenfields[e].hideSuggestions(),_tokenfields[e].blur()}},{key:"_onResize",value:function _onResize(){for(var a in _tokenfields)_tokenfields[a]._resizeInput(_tokenfields[a]._html.input.value)}},{key:"_onPaste",value:function _onPaste(a){var b=this,c=this._vars,d=this._options,e=a.clipboardData.getData("text"),f=[e];if(d.delimiters.length){var h=d.delimiters.join("|"),i=new RegExp("("+h+")","ig");f=e.split(i)}var g=f.map(function(a){return a.trim()}).filter(function(a){return 0<a.length&&a.length>=d.minChars&&"undefined"==typeof c.delimiters[a]}).map(function(a){return b._newItem(a)});g.length&&(setTimeout(function(){b._renderItems()._refreshInput()._deselectItems().hideSuggestions()},1),a.preventDefault())}},{key:"_onKeyDown",value:function _onKeyDown(a){var b=this,c=this._vars,d=this._options,e=this._html;d.maxItems&&c.setItems.length>=d.maxItems&&a.preventDefault(),"tokenfield"===d.mode&&setTimeout(function(){b._resizeInput(e.input.value)},1);var f=keyToChar(a);return"undefined"!=typeof d.keys[a.keyCode]||d.delimiters.includes(f)?(this._keyAction(a),!0):void(this._defocusItems()._refreshItems(),clearTimeout(c.timer),this._abortXhr(),(!d.maxItems||c.setItems.length<d.maxItems)&&setTimeout(function(){b._keyInput(a)},1))}},{key:"_keyAction",value:function _keyAction(a){var b=this,c=null,d=this._vars,e=this.key,f=this._options,g=this._html,h=f.keys[a.keyCode],i=g.input.value.trim(),j=keyToChar(a);f.delimiters.includes(j)&&"undefined"==typeof h&&(h="delimiter");var k=this._getSelectedItems();switch(k.length&&(c=k[0]),h){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),a.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),a.preventDefault()),this._defocusItems()._renderItems();break;case"left":!this.getFocusedItems().length&&(g.input.selectionStart||g.input.selectionEnd)||(this._focusPrevItem(a.shiftKey),a.preventDefault());break;case"right":(this.getFocusedItems().length||g.input.selectionStart===i.length)&&(this._focusNextItem(a.shiftKey),a.preventDefault());break;case"delimiter":if(this._abortXhr(),this._defocusItems(),1==d.setItems.length&&!f.multiple)return!1;i=this.onInput(i),c?this._addItem(c):i.length&&(c=this._newItem(i)),c&&this._renderItems().focus()._refreshInput()._refreshSuggestions()._deselectItems(),a.preventDefault();break;case"select":!i.length&&(a.ctrlKey||a.metaKey)&&(this._vars.setItems.forEach(function(a){a.focused=!0}),this._refreshItems());break;case"copy":{var l=this.getFocusedItems();if(l.length&&(a.ctrlKey||a.metaKey)){var m=this._vars.setItems.filter(function(a){return a.focused}).map(function(a){return a[f.copyProperty]}).join(f.copyDelimiter);g.copyHelper.value=m,g.copyHelper.focus(),g.copyHelper.select(),document.execCommand("copy"),g.copyHelper.value="",g.input.focus()}break}case"delete":{this._abortXhr();var n=this.getFocusedItems();!g.input.selectionEnd&&8===a.keyCode||g.input.selectionStart===i.length&&46===a.keyCode||n.length?(this.hideSuggestions(),"tokenfield"===f.mode&&d.setItems.length?n.length?n.forEach(function(a){b._removeItem(a[e])}):!g.input.selectionStart&&this._focusItem(d.setItems[d.setItems.length-1][e]):n.length&&n.forEach(function(a){b._removeItem(a[e])}),this._renderItems()._refreshInput(!1)):d.timer=setTimeout(function(){b._keyInput(a)},f.delay);break}default:}}},{key:"_keyInput",value:function _keyInput(a){var b=this,c=this._vars,d=this._options,e=this._html;this._defocusItems()._refreshItems();var f=this.onInput(e.input.value.trim(),a);if("keydown"===a.type&&this.emit("input",this,f,a),f.length<d.minChars)return this.hideSuggestions(),!1;if(1==c.setItems.length&&!d.multiple)return!1;if("undefined"!=typeof c.cache[f]){var g=this._prepareData(this.remapData(c.cache[f])),h=this._filterData(f,g);c.suggestedItems=d.filterSetItems?this._filterSetItems(h):h,this.showSuggestions()}else if(d.remote.url)c.timer=setTimeout(function(){b._fetchData(f)},d.delay);else if(!d.remote.url&&d.items.length){var i=this._prepareData(this.remapData(d.items)),j=this._filterData(f,i);c.suggestedItems=d.filterSetItems?this._filterSetItems(j):j,this.showSuggestions()}return this}},{key:"_onClick",value:function _onClick(a){var b=a.target;if(b.classList.contains("item-remove"))a.preventDefault(),this._removeItem(b.key)._defocusItems()._renderItems()._keyInput(a),this.focus();else if(b.classList.contains("tokenfield-suggest-item")){var c=this._getSuggestedItem(b.key);this._addItem(c)._renderItems()._refreshInput()._refreshSuggestions().focus()}else{var d=getPath(b).filter(function(a){return a.classList&&a.classList.contains("tokenfield-set-item")})[0];d?(this._focusItem(d.key,a.shiftKey,a.ctrlKey||a.metaKey,!0),this._refreshItems()):this._keyInput(a),this.focus()}}},{key:"_selectPrevItem",value:function _selectPrevItem(){var a=this.key,b=this._options,c=this._vars.suggestedItems,d=this._getSelectedItemIndex();return c.length?(null===d?this._selectItem(c[c.length-1][a]):0===d?b.newItems?this._deselectItems():this._selectItem(c[c.length-1][a]):this._selectItem(c[d-1][a]),this):this}},{key:"_selectNextItem",value:function _selectNextItem(){var a=this.key,b=this._options,c=this._vars.suggestedItems,d=this._getSelectedItemIndex();return c.length?(null===d?this._selectItem(c[0][a]):d===c.length-1?b.newItems?this._deselectItems():this._selectItem(c[0][a]):this._selectItem(c[d+1][a]),this):this}},{key:"_focusPrevItem",value:function _focusPrevItem(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],b=this.key,c=this._vars.setItems,d=this._getFocusedItemIndex();if(!c.length)return this;if(null===d)this._focusItem(c[c.length-1][b],!1,!1,!0);else if(0===d&&!a)this._defocusItems();else if(0===d&&a){var e=this._getFocusedItemIndex(!0);this._defocusItem(c[e][b])}else this._focusItem(c[d-1][b],a,!1,!0);return this._refreshItems(),this}},{key:"_focusNextItem",value:function _focusNextItem(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],b=this.key,c=this._vars.setItems,d=this._getFocusedItemIndex(!0);return c.length?(null===d?this._focusItem(c[0][b],!1):d!==c.length-1||a?d===c.length-1&&a?this._focusItem(c[0][b],a):this._focusItem(c[d+1][b],a):this._defocusItems(),this._refreshItems(),this):this}},{key:"_getSelectedItems",value:function _getSelectedItems(){var a=this.key,b=this._vars.setItems.map(function(b){return b[a]});return this._vars.suggestedItems.filter(function(c){return c.selected&&0>b.indexOf(c[a])})}},{key:"_selectItem",value:function _selectItem(a){var b=this;this._vars.suggestedItems.forEach(function(c){c.selected=c[b.key]===a})}},{key:"_deselectItem",value:function _deselectItem(a){var b=this;return this._vars.suggestedItems.every(function(c){return c[b.key]!==a||(c.selected=!1,!1)}),this}},{key:"_deselectItems",value:function _deselectItems(){return this._vars.suggestedItems.forEach(function(a){a.selected=!1}),this}},{key:"_refreshItemsSelection",value:function _refreshItemsSelection(){this._vars.suggestedItems.forEach(function(a){a.selected&&a.el?a.el.classList.add("selected"):a.el&&a.el.classList.remove("selected")})}},{key:"_getSelectedItemIndex",value:function _getSelectedItemIndex(){var a=null;return this._vars.suggestedItems.every(function(b,c){return!b.selected||(a=c,!1)}),a}},{key:"_getFocusedItemIndex",value:function _getFocusedItemIndex(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],b=null;return this._vars.setItems.every(function(c,d){return c.focused&&(b=d,!a)?!1:!0}),b}},{key:"_getItem",value:function _getItem(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===b&&(b=this.key);var c=this._filterItems(this._vars.setItems,a,b);return c.length?c[0]:null}},{key:"_getSuggestedItem",value:function _getSuggestedItem(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===b&&(b=this.key);var c=this._filterItems(this._vars.suggestedItems,a,b);return c.length?c[0]:null}},{key:"_getAvailableItem",value:function _getAvailableItem(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===b&&(b=this.key);var c=this._filterItems(this._options.items,a,b);return c.length?c[0]:null}},{key:"_filterItems",value:function _filterItems(a,b,c){return a.filter(function(a){return"string"==typeof a[c]&&"string"==typeof b?a[c].toLowerCase()==b.toLowerCase():a[c]==b})}},{key:"_removeItem",value:function _removeItem(a){var b=this;return this._vars.setItems.every(function(c,d){return c[b.key]!==a||(b.emit("removeToken",b,c),b._vars.setItems.splice(d,1),b.emit("removedToken",b,c),b.emit("change",b),!1)}),this}},{key:"_addItem",value:function _addItem(a){a.focused=!1;var b=this._options;if((a.isNew&&!this._getItem(a[b.itemData],b.itemData)||!this._getItem(a[b.itemValue],b.itemValue))&&(this.emit("addToken",this,a),!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)){a.selected=!1;var c=Object.assign({},a);this._vars.setItems.push(c),this.emit("addedToken",this,c),this.emit("change",this)}return this}},{key:"getFocusedItem",value:function getFocusedItem(){var a=this._vars.setItems.filter(function(a){return a.focused})[0];return a.length?a[0]:null}},{key:"getFocusedItems",value:function getFocusedItems(){return this._vars.setItems.filter(function(a){return a.focused})}},{key:"_focusItem",value:function _focusItem(a){var b=1<arguments.length&&void 0!==arguments[1]&&arguments[1],c=this,d=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(b){var f=null,g=null,h=null,i=this._vars.setItems.length;if(this._vars.setItems.forEach(function(b,d){b[c.key]===a&&(h=d),null==f&&b.focused&&(f=d),b.focused&&(g=d)}),(0===h||h===i-1)&&null===f&&null===g)return;null===f&&null===g?this._vars.setItems[h].focused=!0:0!==h||g!==i-1||e?(f=Math.min(h,f),g=Math.max(h,g),this._vars.setItems.forEach(function(a,b){a.focused=h===b||b>=f&&b<=g})):this._vars.setItems[f].focused=!1}else this._vars.setItems.forEach(function(b){b.focused=d?b[c.key]===a?!b.focused:b.focused:b[c.key]===a});return this}},{key:"_defocusItem",value:function _defocusItem(a){var b=this;return this._vars.setItems.filter(function(c){c[b.key]===a&&(c.focused=!1)})}},{key:"_defocusItems",value:function _defocusItems(){return this._vars.setItems.forEach(function(a){a.focused=!1}),this}},{key:"_newItem",value:function _newItem(a){if("string"==typeof a&&!a.length)return null;var b=this._options,c=this._getItem(a,b.itemData)||this._getSuggestedItem(a,b.itemData)||this._getAvailableItem(a,b.itemData);if(!c&&b.newItems){var d;c=(d={isNew:!0},_defineProperty(d,this.key,guid()),_defineProperty(d,b.itemData,a),d),this.emit("newToken",this,c)}return c?(this._addItem(c),c):null}},{key:"_buildEl",value:function _buildEl(a){return build(a)}},{key:"_getBounds",value:function _getBounds(){return this._html.container.getBoundingClientRect()}},{key:"_renderItems",value:function _renderItems(){var a=this,b=this._vars,c=this._options,d=this._html;return d.items.innerHTML="",b.setItems.forEach(function(b){var c=a._renderItem(b);d.items.appendChild(c),b.el=c,b.focused?b.el.classList.add("focused"):b.el.classList.remove("focused")}),1<b.setItems.length&&"tokenfield"===c.mode&&d.input.setAttribute("placeholder",""),this}},{key:"_refreshItems",value:function _refreshItems(){var a=this._vars;a.setItems.forEach(function(a){a.el&&(a.focused?a.el.classList.add("focused"):a.el.classList.remove("focused"))})}},{key:"_renderItem",value:function _renderItem(a){var b=this._options,c=this.renderSetItemHtml(a),d=c.querySelector(".item-label"),e=c.querySelector(".item-input"),f=c.querySelector(".item-remove");return c.key=a[this.key],f.key=a[this.key],e.setAttribute("name",(a.isNew?b.newItemName:b.itemName)+"[]"),e.value=a[a.isNew?b.newItemValue:b.itemValue]||null,d.textContent=this.renderSetItemLabel(a),a.focused&&c.classList.add("focused"),c}},{key:"onInput",value:function onInput(a){return a}},{key:"renderSetItemHtml",value:function renderSetItemHtml(){return this._buildEl(this._templates.setItem)}},{key:"renderSetItemLabel",value:function renderSetItemLabel(a){return a[this._options.itemLabel]}},{key:"renderSuggestions",value:function renderSuggestions(a){var b=this,c=this._vars,d=this._options,e=this._html,f=this._getSelectedItemIndex();return a.length?(e.suggestList.innerHTML="",!c.suggestedItems.length)?this:(d.newItems||null!==f||(a[0].selected=!0),a.every(function(a,c){if(c>=d.maxSuggest)return!1;var f=b.renderSuggestedItem(a);return a.el=f,e.suggestList.appendChild(f),!0}),this):this}},{key:"renderSuggestedItem",value:function renderSuggestedItem(a){var b=this._options,c=this._buildEl(this._templates.suggestItem);if(c.key=a[this.key],c.innerHTML=a[b.itemData],c.setAttribute("title",a[b.itemData]),a.selected&&c.classList.add("selected"),!b.filterSetItems){var d=this._getItem(a[b.itemValue],b.itemValue)||this._getItem(a[b.itemData],b.itemData);d&&c.classList.add("set")}return c}},{key:"showSuggestions",value:function showSuggestions(){return this._vars.suggestedItems.length?(this.emit("showSuggestions",this),(!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)&&(this.renderSuggestions(this._vars.suggestedItems),this._html.suggest.style.display="block",this._vars.suggested=!0),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}},{key:"_refreshSuggestions",value:function _refreshSuggestions(){var a=this._vars,b=this._options;if(this._html.input.value.length<b.minChars)return this.hideSuggestions(),this;var c=this._prepareData(this.remapData(b.items)),d=this._filterData(this._html.input.value,c);return a.suggestedItems=b.filterSetItems?this._filterSetItems(d):d,a.suggestedItems.length?!b.maxItems||b.maxItems&&a.setItems.length<b.maxItems?this.renderSuggestions(a.suggestedItems):this.hideSuggestions():this.hideSuggestions(),this}},{key:"hideSuggestions",value:function hideSuggestions(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}},{key:"getItems",value:function getItems(){return this._vars.setItems.map(function(a){return Object.assign({},a)})}},{key:"setItems",value:function setItems(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(a)||(a=[a]),this._vars.setItems=this._prepareData(a||[]),this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"addItems",value:function addItems(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],b=this._options.itemValue;Array.isArray(a)||(a=[a]);var c={};if(this.getItems().forEach(function(a){c[a[b]]=!0}),a=a.filter(function(a){return!0!==c[a[b]]}),!a.length)return this;var d=this._prepareData(a);return this._vars.setItems=this._vars.setItems.concat(d),this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"removeItem",value:function removeItem(a){var b=this._options;"object"===("undefined"==typeof a?"undefined":_typeof(a))&&(a[b.itemValue]||a[b.newItemValue])&&(a=a[b.itemValue]||a[b.newItemValue]);var c=this._getItem(a,b.itemValue)||this._getItem(a,b.newItemValue);return c?(this._removeItem(c[this.key])._renderItems(),this):this}},{key:"emptyItems",value:function emptyItems(){return this._vars.setItems=[],this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"getSuggestedItems",value:function getSuggestedItems(){return this._vars.suggestedItems.map(function(a){return Object.assign({},a)})}},{key:"focus",value:function focus(){return this._html.container.classList.add("focused"),this._html.input.focus(),this}},{key:"blur",value:function blur(){return this._html.container.classList.remove("focused"),this._html.input.blur(),this}},{key:"remove",value:function remove(){var a=this._html;a.container.parentElement.insertBefore(this.el,a.container),a.container.remove(),this.el.style.display="block",1===Object.keys(_tokenfields).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),this._form&&this._form.nodeName&&this._form.removeEventListener("reset",this._vars.events.onReset),delete _tokenfields[this.id],delete this.el.tokenfield}}]),b}(_events2.default);exports.default=Tokenfield},{events:7}],7:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}]},{},[3]);
